<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>game 1</title>
    <style>
    #id-canvas {
        border: 1px solid #000;
    }
    </style>
</head>

<body>
    <canvas id="id-canvas" width="400" height="300"></canvas>
    <script>
    var log = console.log.bind(console);
    var imageFromPath = function(path) {
        var img = new Image();
        img.src = path;
        return img;
    };
    var Paddle = function() {
        var image = imageFromPath("./img/blank.png");
        var o = {
            image: image,
            x: 100,
            y: 250,
            speed: 5,
            moveLeft: function() {
                this.x -= this.speed;
            },
            moveRight: function() {
                this.x += this.speed;
            },
            collide:function (ball) {
                if(ball.y>this.y-ball.image.height){
                    if(ball.x>this.x&&ball.x<this.x+this.image.width){
                        log("装")
                        return true;
                    }
                }
                return false;
            },
        };

        return o;
    };
    var Ball = function() {
        var image = imageFromPath("./img/ball.png");
        var o = {
            image: image,
            x: 150,
            y: 210,
            speedX:5,
            speedY:5,
            fired: false,
            fire: function() {
                this.fired = true;
            },
            move: function() {
                if (this.fired){
                    if(this.x<0||this.x>400){
                        this.speedX=-this.speedX
                    }
                    if(this.y<0||this.y>300){
                        this.speedY=-this.speedY
                    }
                    //move
                    this.x+=this.speedX;
                    this.y+=this.speedY;
                }
            },
        };
        return o;
    };

    var GuaGame = function() {
        var canvas = document.getElementById("id-canvas");
        var context = canvas.getContext("2d");
        var g = {
            canvas: canvas,
            context: context,
            actions: {},
            keydowns: {},
        };
        //evnets
        window.addEventListener("keydown", function(e) {
            g.keydowns[e.key] = true;
        });
        window.addEventListener("keyup", function(e) {
            g.keydowns[e.key] = false;
        });
        //register
        g.registerAction = function(key, callback) {
            g.actions[key] = callback;

        };
        //draw
        g.drawImage = function(o) {
            g.context.drawImage(o.image, o.x, o.y);
        };
        //timer
        setInterval(function() {
            //events
            var actions = Object.keys(g.actions);
            for (var i = 0; i < actions.length; i++) {
                var key = actions[i];
                if (g.keydowns[key]) {
                    //如果按键按下，调用注册的action
                    g.actions[key]();
                }
            }
            //update
            if (g.update) {
                g.update();
            }

            //clear
            context.clearRect(0, 0, canvas.width, canvas.height);
            //draw
            if (g.draw) {
                g.draw();
            }

        }, 1000 / 80)

        return g;
    };
    var __main = function() {
        var game = GuaGame();
        var paddle = Paddle();
         ball = Ball();
        game.registerAction("a", function() {
            paddle.moveLeft();
        });
        game.registerAction("d", function() {
            paddle.moveRight();
        });
        game.registerAction("f", function() {
            ball.fire();
        });
        game.update = function() {

            ball.move();
            if(paddle.collide(ball)){
                log("做了");
                ball.speedY=-ball.speedY;
                log(ball.speedY)
            }
        };
        game.draw = function() {
            game.drawImage(paddle);
            game.drawImage(ball);
        };
    };

    __main();
    </script>
</body>

</html>